<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Daisuke v1.3 - AI Chatbot with Wikipedia</title>
  <style>
    /* Global Styles */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }
    
    body {
      background-color: #121212;
      color: #e0e0e0;
      line-height: 1.6;
    }
    
    /* Navigation */
    nav {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 1rem 5%;
      background-color: #000000;
      position: sticky;
      top: 0;
      z-index: 100;
      border-bottom: 2px solid #00ff88;
    }
    
    .logo {
      font-size: 1.5rem;
      font-weight: bold;
      color: #00ff88;
      text-decoration: none;
    }
    
    .nav-links {
      display: flex;
      gap: 1.5rem;
    }
    
    .nav-links a {
      color: #e0e0e0;
      text-decoration: none;
      font-weight: 500;
      font-size: 0.95rem;
      transition: all 0.3s;
      padding: 0.5rem 0.8rem;
      border-radius: 4px;
    }
    
    .nav-links a:hover {
      color: #00ff88;
      background-color: rgba(0, 255, 136, 0.1);
    }
    
    /* Main Container */
    .container {
      max-width: 800px;
      margin: 2rem auto;
      padding: 0 2rem;
    }
    
    /* Chatbot Header */
    .chat-header {
      text-align: center;
      padding: 1.5rem;
      background-color: #000;
      color: #00ff88;
      font-size: 2rem;
      font-weight: bold;
      border-bottom: 2px solid #00ff88;
      border-radius: 8px 8px 0 0;
    }
    
    /* Chat Box */
    .chat-box {
      padding: 1.5rem;
      height: 500px;
      overflow-y: auto;
      background-color: #1e1e1e;
      border-left: 1px solid #333;
      border-right: 1px solid #333;
    }
    
    .user-msg, .bot-msg-group {
      margin: 0.8rem 0;
      max-width: 80%;
      border-radius: 8px;
      padding: 0.8rem 1rem;
      line-height: 1.5;
    }
    
    .user-msg {
      background-color: #004d26;
      align-self: flex-end;
      margin-left: auto;
      border: 1px solid #007a3d;
    }
    
    .bot-msg-group {
      background-color: #262626;
      align-self: flex-start;
      border-left: 3px solid #00ff88;
    }
    
    .bot-msg-group p {
      margin: 0.5rem 0;
    }
    
    /* Wikipedia result styling */
    .wiki-result {
      font-style: italic;
      color: #aaa;
      margin-top: 1rem;
      padding-top: 1rem;
      border-top: 1px dashed #444;
    }
    
    /* Input Area */
    .input-area {
      display: flex;
      background-color: #1e1e1e;
      padding: 1rem;
      border-radius: 0 0 8px 8px;
      border-left: 1px solid #333;
      border-right: 1px solid #333;
      border-bottom: 1px solid #333;
    }
    
    #user-input {
      flex: 1;
      padding: 0.8rem 1rem;
      background-color: #121212;
      border: 1px solid #333;
      color: #e0e0e0;
      border-radius: 5px 0 0 5px;
      font-size: 1rem;
    }
    
    #user-input:focus {
      outline: none;
      border-color: #00ff88;
    }
    
    #send-btn {
      background-color: #00ff88;
      border: none;
      padding: 0 1.5rem;
      cursor: pointer;
      color: #000;
      font-weight: bold;
      font-size: 1rem;
      border-radius: 0 5px 5px 0;
      transition: all 0.3s;
    }
    
    #send-btn:hover {
      background-color: #00cc6a;
    }
    
    /* Loading Screen */
    .loading-screen {
      position: fixed;
      background-color: #000;
      color: #00ff88;
      font-size: 1.5rem;
      font-weight: bold;
      top: 0; 
      left: 0; 
      right: 0; 
      bottom: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 9999;
    }
    
    /* Typing Animation */
    .typing-dots span {
      display: inline-block;
      font-size: 1.5rem;
      animation: blink 1s infinite;
    }
    
    .typing-dots span:nth-child(2) {
      animation-delay: 0.2s;
    }
    
    .typing-dots span:nth-child(3) {
      animation-delay: 0.4s;
    }
    
    @keyframes blink {
      0%, 100% { opacity: 0.2; }
      50% { opacity: 1; }
    }
    
    /* Footer */
    footer {
      text-align: center;
      padding: 2rem;
      background-color: #000000;
      margin-top: 3rem;
      border-top: 2px solid #00ff88;
    }
    
    .footer-links {
      display: flex;
      justify-content: center;
      gap: 2rem;
      margin-bottom: 1rem;
    }
    
    .footer-links a {
      color: #e0e0e0;
      text-decoration: none;
      transition: color 0.3s;
    }
    
    .footer-links a:hover {
      color: #00ff88;
    }
    
    /* Responsive Design */
    @media (max-width: 768px) {
      .container {
        padding: 0 1rem;
      }
      
      .nav-links {
        gap: 0.8rem;
      }
      
      .nav-links a {
        font-size: 0.85rem;
        padding: 0.4rem 0.6rem;
      }
      
      .chat-box {
        height: 400px;
        padding: 1rem;
      }
      
      .user-msg, .bot-msg-group {
        max-width: 90%;
      }
    }
    
    @media (max-width: 480px) {
      nav {
        flex-direction: column;
        padding: 1rem;
      }
      
      .logo {
        margin-bottom: 0.8rem;
      }
      
      .nav-links {
        width: 100%;
        justify-content: space-between;
      }
    }
  </style>
</head>
<body>
  <nav>
    <a href="https://flownetic.github.io/Flovvnetic/" class="logo">Daisuke AI</a>
    <div class="nav-links">
      <a href="https://flownetic.github.io/Flovvnetic/">Home</a>
      <a href="https://flownetic.github.io/flovvnetic_services/">Services</a>
      <a href="https://flownetic.github.io/flovvnetic_about/">About</a>
      <a href="https://flownetic.github.io/flovvnetic_contact/">Contact</a>
    </div>
  </nav>

  <div class="loading-screen" id="loading-screen">
    <div id="loading-message">Loading Daisuke AI...</div>
  </div>

  <div class="container">
    <div class="chat-header">Daisuke AI Assistant v1.3</div>
    <div class="chat-box" id="chat-box">
      <div class="bot-msg-group">
        <p>Hello! I'm Daisuke, your AI assistant. How can I help you today?</p>
        <p class="wiki-result">Now with Wikipedia integration for broader knowledge!</p>
      </div>
    </div>
    <div class="input-area">
      <input type="text" id="user-input" placeholder="Type your message here..." autocomplete="off">
      <button id="send-btn">Send</button>
    </div>
  </div>

  <footer>
    <div class="footer-links">
      <a href="#">Privacy Policy</a>
      <a href="#">Terms of Service</a>
      <a href="#">Contact Us</a>
    </div>
    <p>&copy; 2025 Daisuke AI. All rights reserved.</p>
  </footer>

  <script>
    const chatBox = document.getElementById('chat-box');
    const userInput = document.getElementById('user-input');
    const sendBtn = document.getElementById('send-btn');
    const loadingScreen = document.getElementById('loading-screen');
    const loadingMessage = document.getElementById('loading-message');

    const questionWords = ['what', 'how', 'who', 'why', 'when', 'where', 'which', 'whom', 'whose'];
    const helpingVerbs = ['is', 'am', 'are', 'was', 'were', 'do', 'does', 'did', 'have', 'has', 'had', 'will', 'would', 'shall', 'should', 'can', 'could', 'may', 'might', 'must'];
    const pronouns = ['i', 'you', 'he', 'she', 'it', 'we', 'they', 'me', 'him', 'her', 'us', 'them', 'my', 'your', 'his', 'its', 'our', 'their'];

    let basicData = {};

    function cleanText(text) {
      return text.toLowerCase().replace(/[^\w\s_]/g, '').split(/\s+/).filter(Boolean);
    }

    function removeQWords(text) {
      const words = cleanText(text);
      return words.filter(word =>
        !questionWords.includes(word) &&
        !pronouns.includes(word) &&
        !helpingVerbs.includes(word)
      ).join(' ');
    }

    function similarity(a, b) {
      let matches = 0;
      a = a.toLowerCase();
      b = b.toLowerCase();
      const len = Math.max(a.length, b.length);
      for (let i = 0; i < len; i++) {
        if (a[i] === b[i]) matches++;
      }
      return (matches / len) * 100;
    }

    async function fetchJSON(path) {
      loadingMessage.textContent = `ðŸ”„ Loading: ${path}...`;
      try {
        const res = await fetch(path);
        if (res.ok) return await res.json();
      } catch (e) {}
      return null;
    }

    function addMessage(text, type) {
      const msg = document.createElement('div');
      msg.className = type === 'user' ? 'user-msg' : 'bot-msg-group';
      if (Array.isArray(text)) {
        text.forEach(t => {
          const p = document.createElement('p');
          p.textContent = t;
          msg.appendChild(p);
        });
      } else {
        const p = document.createElement('p');
        p.textContent = text;
        msg.appendChild(p);
      }
      chatBox.appendChild(msg);
      chatBox.scrollTop = chatBox.scrollHeight;
    }

    function addTypingIndicator() {
      const msg = document.createElement('div');
      msg.className = 'bot-msg-group';
      msg.innerHTML = '<span class="typing-dots"><span>.</span><span>.</span><span>.</span></span>';
      chatBox.appendChild(msg);
      chatBox.scrollTop = chatBox.scrollHeight;
      return msg;
    }

    async function searchWikipedia(query) {
      try {
        // Use Wikipedia API to search for the query
        const endpoint = `https://en.wikipedia.org/w/api.php?action=query&format=json&origin=*&prop=extracts&exintro&explaintext&redirects=1&titles=${encodeURIComponent(query)}`;
        
        const response = await fetch(endpoint);
        const data = await response.json();
        
        const pages = data.query.pages;
        const pageId = Object.keys(pages)[0];
        
        if (pageId === "-1") {
          return ["I couldn't find any Wikipedia results for that query."];
        }
        
        const extract = pages[pageId].extract;
        if (!extract) {
          return ["Wikipedia has an article about this, but I couldn't retrieve the content."];
        }
        
        // Get the first 10 lines of the extract
        const lines = extract.split('\n').filter(line => line.trim().length > 0);
        const firstLines = lines.slice(0, 10);
        
        // Add Wikipedia attribution
        const result = [
          "I found this information on Wikipedia:",
          ...firstLines,
          `\n[Read more on Wikipedia](https://en.wikipedia.org/?curid=${pageId})`
        ];
        
        return result;
      } catch (error) {
        console.error("Wikipedia search error:", error);
        return ["I encountered an error while searching Wikipedia. Please try again later."];
      }
    }

    async function searchAnswer(query) {
      const foundAnswers = [];

      // First check basic responses
      const basic = await fetchJSON('basic/basic.json');
      if (basic) {
        if (basic[query]) return [basic[query]];
        for (let key in basic) {
          if (similarity(key, query) > 90) return [basic[key]];
        }
      }

      const clean = removeQWords(query);
      const wordsArray = cleanText(query);
      const keywords = wordsArray.filter(w =>
        !pronouns.includes(w) &&
        !helpingVerbs.includes(w) &&
        !questionWords.includes(w)
      );

      if (keywords.length === 0) return ["Your question does not make sense."];

      // Check custom responses
      let file = await fetchJSON(`custom/${keywords[0][0]}.json`);
      if (file) {
        for (let key in file) {
          if (similarity(key.replace(/_/g, ' '), clean) > 85) {
            foundAnswers.push(file[key]);
          }
        }
      }

      // Check common responses
      if (foundAnswers.length === 0) {
        file = await fetchJSON(`commen/${keywords[0][0]}.json`);
        if (file) {
          for (let key in file) {
            if (similarity(key.replace(/_/g, ' '), clean) > 85) {
              foundAnswers.push(file[key]);
            }
          }
        }
      }

      // Check data responses
      if (foundAnswers.length === 0) {
        for (let word of keywords) {
          const a = word[0];
          const b = word[1] || 'a';
          file = await fetchJSON(`data/${a}/${b}.json`);
          if (file) {
            for (let key in file) {
              const sim = similarity(key, word);
              if (sim > 90 || (sim > 50 && key.includes('_'))) {
                foundAnswers.push(file[key]);
              }
            }
          }
        }
      }

      // If still no answers, search Wikipedia
      if (foundAnswers.length === 0) {
        const wikiResults = await searchWikipedia(query);
        if (wikiResults && wikiResults.length > 0) {
          return wikiResults;
        }
      }

      return foundAnswers.length ? [...new Set(foundAnswers)] : ["I'm not sure I understand. Could you rephrase your question?"];
    }

    async function handleSend() {
      const input = userInput.value.trim();
      if (!input) return;

      addMessage(input, 'user');
      userInput.value = '';
      const typingMsg = addTypingIndicator();

      const replies = await searchAnswer(input);
      typingMsg.remove();

      if (Array.isArray(replies) {
        // Create a single message container for all replies
        const msg = document.createElement('div');
        msg.className = 'bot-msg-group';
        
        // Add each reply as a paragraph
        replies.forEach((reply, index) => {
          const p = document.createElement('p');
          p.textContent = reply;
          
          // Add wiki-result class to Wikipedia attribution
          if (replies.length > 1 && index === replies.length - 1 && reply.includes('Wikipedia')) {
            p.className = 'wiki-result';
          }
          
          msg.appendChild(p);
        });
        
        chatBox.appendChild(msg);
        chatBox.scrollTop = chatBox.scrollHeight;
      } else {
        addMessage(["I'm not sure I understand. Could you rephrase your question?"], 'bot');
      }
    }

    // Add navigation functionality
    document.querySelectorAll('.nav-links a').forEach(link => {
      link.addEventListener('click', function(e) {
        e.preventDefault();
        const page = this.textContent.toLowerCase();
        addMessage(`You clicked on the ${page} page. How can I assist you with ${page}?`, 'bot');
      });
    });

    sendBtn.addEventListener('click', handleSend);
    userInput.addEventListener('keypress', e => {
      if (e.key === 'Enter') handleSend();
    });

    window.addEventListener('DOMContentLoaded', async () => {
      basicData = await fetchJSON('basic/basic.json');
      loadingScreen.style.display = 'none';
    });
  </script>
</body>
</html>
