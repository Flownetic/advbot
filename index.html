<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Alphabetical Chatbot - Flovvnetic.io</title>
    <style>
        /* Global Styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #121212;
            color: #e0e0e0;
            line-height: 1.6;
        }
        
        /* Navigation */
        nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1.5rem 5%;
            background-color: #000000;
            position: sticky;
            top: 0;
            z-index: 100;
            border-bottom: 2px solid #00ff88;
        }
        
        .logo {
            font-size: 1.8rem;
            font-weight: bold;
            color: #00ff88;
            text-decoration: none;
        }
        
        /* Chatbot Container */
        .chatbot-container {
            max-width: 800px;
            margin: 3rem auto;
            background-color: #1e1e1e;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0, 255, 136, 0.1);
            border: 1px solid #333333;
        }
        
        .chatbot-header {
            background-color: #000000;
            padding: 1.5rem;
            border-bottom: 2px solid #00ff88;
            text-align: center;
        }
        
        .chatbot-header h2 {
            color: #00ff88;
            margin-bottom: 0.5rem;
        }
        
        .chatbot-header p {
            color: #b0b0b0;
        }
        
        #chat-container {
            height: 500px;
            padding: 1.5rem;
            background-color: #121212;
            overflow-y: auto;
        }
        
        .user-message {
            text-align: right;
            margin: 8px 0;
            padding: 10px 15px;
            background-color: #003d1f;
            border-radius: 18px;
            display: inline-block;
            max-width: 80%;
            float: right;
            clear: both;
            border: 1px solid #00a55a;
            color: #e0e0e0;
        }
        
        .bot-message {
            text-align: left;
            margin: 8px 0;
            padding: 10px 15px;
            background-color: #1a1a1a;
            border-radius: 18px;
            display: inline-block;
            max-width: 80%;
            float: left;
            clear: both;
            border: 1px solid #333333;
            color: #e0e0e0;
        }
        
        .result-box {
            margin: 15px 0;
            padding: 15px;
            background-color: #252525;
            border-radius: 8px;
            border-left: 3px solid #00ff88;
        }
        
        .result-title {
            font-weight: bold;
            color: #00ff88;
            margin-bottom: 8px;
        }
        
        .loading {
            color: #888;
            font-style: italic;
        }
        
        .chat-input-container {
            display: flex;
            padding: 1rem;
            background-color: #000000;
            border-top: 1px solid #333333;
        }
        
        #user-input {
            flex: 1;
            padding: 0.8rem 1rem;
            background-color: #1e1e1e;
            border: 1px solid #333333;
            border-radius: 4px;
            color: #e0e0e0;
            font-size: 1rem;
        }
        
        #user-input:focus {
            outline: none;
            border-color: #00ff88;
        }
        
        #send-btn {
            margin-left: 0.5rem;
            padding: 0.8rem 1.5rem;
            background-color: #00ff88;
            color: #121212;
            border: none;
            border-radius: 4px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        #send-btn:hover {
            background-color: #00cc6a;
            transform: translateY(-2px);
        }
        
        /* Footer */
        footer {
            text-align: center;
            padding: 2rem;
            background-color: #000000;
            margin-top: 3rem;
            border-top: 2px solid #00ff88;
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            #chat-container {
                height: 400px;
                padding: 1rem;
            }
            
            .user-message, .bot-message {
                max-width: 90%;
            }
        }
    </style>
</head>
<body>
    <nav>
        <a href="#" class="logo">Advanced Alphabetical Search</a>
    </nav>

    <div class="chatbot-container">
        <div class="chatbot-header">
            <h2>Nested Alphabetical Knowledge Base</h2>
            <p>Enter a sentence to search through our A-Z knowledge hierarchy</p>
        </div>
        
        <div id="chat-container"></div>
        
        <div class="chat-input-container">
            <input type="text" id="user-input" placeholder="Type a sentence (e.g., 'apple banana cherry')..." autofocus>
            <button id="send-btn">Search</button>
        </div>
    </div>

    <footer>
        <p>&copy; 2023 Flovvnetic.io Advanced Search. All rights reserved.</p>
    </footer>

    <script>
        const chatContainer = document.getElementById('chat-container');
        const userInput = document.getElementById('user-input');
        const sendBtn = document.getElementById('send-btn');

        // Words to ignore (question words and single characters)
        const IGNORE_WORDS = new Set([
            'what', 'where', 'when', 'why', 'how', 'who', 'whom', 'whose', 'which',
            'is', 'are', 'was', 'were', 'do', 'does', 'did', 'can', 'could', 'will',
            'would', 'should', 'may', 'might', 'must', 'a', 'an', 'the', 'and', 'or',
            'but', 'of', 'to', 'in', 'on', 'at', 'for', 'with', 'as', 'by', 'from'
        ]);

        // Cache for loaded data files
        const dataCache = {};

        function addMessage(sender, message, isHTML = false) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `${sender}-message`;
            
            if (isHTML) {
                messageDiv.innerHTML = message;
            } else {
                messageDiv.textContent = message;
            }
            
            chatContainer.appendChild(messageDiv);
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }

        function createResultBox(title, content) {
            const box = document.createElement('div');
            box.className = 'result-box';
            
            const titleElement = document.createElement('div');
            titleElement.className = 'result-title';
            titleElement.textContent = title;
            
            const contentElement = document.createElement('div');
            contentElement.innerHTML = content;
            
            box.appendChild(titleElement);
            box.appendChild(contentElement);
            
            return box;
        }

        async function loadNestedData(path) {
            // Check cache first
            if (dataCache[path]) {
                return dataCache[path];
            }

            try {
                const response = await fetch(`data/${path}.json`);
                if (!response.ok) throw new Error('File not found');
                
                const data = await response.json();
                dataCache[path] = data; // Cache the data
                return data;
            } catch (error) {
                console.error(`Error loading ${path}.json:`, error);
                return null;
            }
        }

        function processInput(text) {
            // Convert to lowercase and remove punctuation
            const cleanText = text.toLowerCase().replace(/[.,\/#!$%\^&\*;:{}=\-_`~()?]/g, '');
            
            // Split into words and filter out ignored words and single characters
            return cleanText.split(/\s+/)
                .filter(word => word.length > 1 && !IGNORE_WORDS.has(word));
        }

        async function searchForTerm(pathParts, term) {
            const path = pathParts.join('/');
            const data = await loadNestedData(path);
            
            if (!data) {
                return { found: false, message: `No data available for path: ${path}` };
            }
            
            // Check for exact match first
            if (data[term]) {
                return { found: true, result: data[term] };
            }
            
            // Check for partial matches
            for (const [key, value] of Object.entries(data)) {
                if (term.includes(key) {
                    return { found: true, result: value };
                }
                if (key.includes(term)) {
                    return { found: true, result: value };
                }
            }
            
            return { found: false, message: `No definition found for "${term}" in ${path}` };
        }

        async function handleUserInput() {
            const query = userInput.value.trim();
            if (!query) return;
            
            addMessage('user', query);
            userInput.value = '';
            
            // Show loading indicator
            const loadingMsg = document.createElement('div');
            loadingMsg.className = 'bot-message loading';
            loadingMsg.textContent = 'Searching knowledge base...';
            chatContainer.appendChild(loadingMsg);
            chatContainer.scrollTop = chatContainer.scrollHeight;
            
            // Process the input
            const searchTerms = processInput(query);
            
            if (searchTerms.length === 0) {
                chatContainer.removeChild(loadingMsg);
                addMessage('bot', "Please enter meaningful words to search (avoid question words and single letters).");
                return;
            }
            
            // Build the path from the first letters of each term
            const pathParts = [];
            const results = [];
            
            for (const term of searchTerms) {
                const firstLetter = term[0].toLowerCase();
                if (!/[a-z]/.test(firstLetter)) continue;
                
                pathParts.push(firstLetter);
                const searchResult = await searchForTerm(pathParts, term);
                
                if (searchResult.found) {
                    results.push({
                        term: term,
                        definition: searchResult.result
                    });
                }
            }
            
            // Remove loading indicator
            chatContainer.removeChild(loadingMsg);
            
            if (results.length === 0) {
                addMessage('bot', "No definitions found for any of the search terms. Try different words.");
                return;
            }
            
            // Display results
            addMessage('bot', `Found ${results.length} definition(s):`);
            
            for (const result of results) {
                const resultBox = createResultBox(
                    result.term.charAt(0).toUpperCase() + result.term.slice(1),
                    result.definition
                );
                chatContainer.appendChild(resultBox);
            }
            
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }

        // Event listeners
        sendBtn.addEventListener('click', handleUserInput);
        userInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') handleUserInput();
        });

        // Initial message
        addMessage('bot', "Welcome to the Advanced Alphabetical Search! Enter a sentence and I'll search for each meaningful word in our nested A-Z knowledge base.");
        addMessage('bot', "Example: Try 'apple banana fruit' to search a/apple.json, then a/b/banana.json, then f/fruit.json");
    </script>
</body>
</html>
